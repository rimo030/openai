/// AI 모델 정보.
///
///
/// @namespace AI-Model
model AIModel {
    /// PK. 아이디
    ///
    ///
    id String @id @db.Uuid

    /// 모델 이름 (예: gpt-4o)
    ///
    ///
    name String @unique

    /// 모델 제공자 (예: OpenAI)
    ///
    ///
    provider String

    /// 모델 등록 시간
    ///
    ///
    created_at DateTime @db.Timestamptz()

    /// relations
    token_usages  TokenUsage[]
    snapshots     AIModelSnapshot[]
    last_snapshot AIModelLastSnapshot?

    @@unique([provider, name])
}

/// AI 모델 스냅샷
/// 
/// 모델 추가시 수기로 아래 내용을 기입해야한다.
///
/// @namespace AI-Model
model AIModelSnapshot {
    /// PK. 스냅샷 아이디
    ///
    ///
    id String @id @db.Uuid

    /// {@link AIModel AI모델}의 아이디
    ///
    ///
    model_id String @db.Uuid

    /// 모델 버전 (예: 4o)
    ///
    /// null인 경우는 모른다 / 혹은 지정하지 않은 것을 의미
    version String?

    /// 최대 지원 토큰 길이 (예: 128000)
    ///
    ///
    context_length Int?

    /// 입력 토큰당 텍스트 비용 (USD)
    ///
    /// 음성 파일의 경우에도 프롬프트를 넣을 수 있기 때문에 0의 값이 아닐 수 있다.
    cost_per_text_input_1m_tokens Decimal

    /// 캐시된 입력 토큰당 텍스트 비용 (USD)
    ///
    /// 음성 파일의 경우에도 프롬프트를 넣을 수 있기 때문에 0의 값이 아닐 수 있다.
    cost_per_text_cached_input_1m_tokens Decimal

    /// 출력 토큰당 텍스트 비용 (USD)
    ///
    ///
    cost_per_text_output_1m_tokens Decimal

    /// 1분 당 비용 (USD)
    ///
    ///
    cost_per_audio_1_minutes Decimal

    /// 스냅샷 생성날짜
    ///
    ///
    created_at DateTime @db.Timestamptz()

    /// relations
    model         AIModel              @relation(fields: [model_id], references: [id])
    last_snapshot AIModelLastSnapshot?

    @@index([model_id, created_at])
}

/// 모델 마지막 스냅샷
/// 
///
model AIModelLastSnapshot {
    /// {@link AIModel AI모델}의 아이디
    ///
    ///
    model_id String @id @db.Uuid

    /// {@link AIModelSnapshot AI모델 스냅샷}의 아이디
    ///
    ///
    snapshot_id String @db.Uuid

    /// relations
    ai_model AIModel         @relation(fields: [model_id], references: [id])
    snapshot AIModelSnapshot @relation(fields: [snapshot_id], references: [id])

    @@unique([snapshot_id])
}

/// 토큰 사용량 및 비용
/// 
///
/// @namespace AI-Model
model TokenUsage {
    /// PK. 아이디
    ///
    ///
    id String @id @db.Uuid

    /// 요청 아이디
    /// 하나의 API 요청 또는 하나의 소켓 요청은 동일한 request_id를 가진다.
    ///
    /// 비용을 추적하기 용이하게 하기 위한 목적으로 추가.
    request_id String @db.Uuid

    /// FK. 유저 ID
    ///
    ///
    user_id String @db.Uuid

    /// FK. 사용한 멤버 ID
    ///
    ///
    member_id String? @db.Uuid

    /// FK. 모델 아이디 
    ///
    /// 사용한 모델 
    ai_model_id String @db.Uuid

    /// Input 토큰 사용량
    ///
    ///
    input_token Int

    /// Input 토큰 비용 (USD)
    ///
    ///
    cost_input_tokens Decimal

    /// Cached Input 토큰 사용량
    ///
    ///
    cached_input_token Int

    /// Cached Input 토큰 비용 (USD)
    ///
    ///
    cost_cached_input_tokens Decimal

    /// Output 토큰 사용량
    ///
    ///
    output_token Int

    /// Output 토큰 비용 (USD)
    ///
    ///
    cost_output_tokens Decimal

    /// 오디오 모델을 사용한 경우, 사용한 오디오 음성 길이
    ///
    ///
    duration Decimal?

    /// Output 토큰 비용 (USD)
    ///
    ///
    cost_durations Decimal?

    /// 생성 시점
    ///
    ///
    created_at DateTime @db.Timestamptz()

    /// relations
    ai_model AIModel @relation(fields: [ai_model_id], references: [id])
    user     User    @relation(fields: [user_id], references: [id])
    // member   Member? @relation(fields: [member_id], references: [id])
}
